<!DOCTYPE html>
<html>
<head>
  <title>Mic Test - Web Audio</title>
  <style>
    body { background: black; margin: 0; overflow: hidden; }
    #bar {
      position: absolute;
      bottom: 0;
      right: 10px;
      width: 20px;
      background: lime;
    }
  </style>
</head>
<body>
  <div id="bar"></div>

  <script>
    const bar = document.getElementById("bar");

    navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
      const context = new AudioContext();
      const mic = context.createMediaStreamSource(stream);
      const analyser = context.createAnalyser();
      mic.connect(analyser);

      const data = new Uint8Array(analyser.frequencyBinCount);

      function draw() {
        analyser.getByteTimeDomainData(data);
        let sum = 0;
        for (let i = 0; i < data.length; i++) {
          let v = (data[i] - 128) / 128;
          sum += v * v;
        }
        let volume = Math.sqrt(sum / data.length);
        bar.style.height = (volume * window.innerHeight * 2) + "px";
        requestAnimationFrame(draw);
      }

      draw();
    }).catch(err => {
      console.error("Mic error:", err);
    });
  </script>
</body>
</html>
